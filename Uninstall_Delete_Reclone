#!/bin/bash

# ==========================================
# FULL RESET SCRIPT FOR INKYPI
# Stops service, removes everything,
# reclones repository cleanly
# ==========================================

APPNAME="inkypi"
INSTALL_PATH="/usr/local/$APPNAME"
BIN_PATH="/usr/local/bin/$APPNAME"
SERVICE_PATH="/etc/systemd/system/$APPNAME.service"

# CHANGE THIS TO YOUR REAL REPO URL
REPO_URL="https://github.com/morelos-ricardo/InkyRic.git"

# CHANGE THIS TO WHERE YOU WANT IT CLONED
CLONE_DIR="/home/pi/inkypi"

echo "=============================="
echo " InkyPi FULL RESET STARTING"
echo "=============================="

# Must run as root
if [ "$EUID" -ne 0 ]; then
  echo "Please run with sudo."
  exit 1
fi

echo ""
echo "Stopping service..."
systemctl stop $APPNAME.service 2>/dev/null

echo "Disabling service..."
systemctl disable $APPNAME.service 2>/dev/null

echo "Removing systemd service file..."
rm -f "$SERVICE_PATH"

echo "Reloading systemd..."
systemctl daemon-reload

echo "Removing executable..."
rm -f "$BIN_PATH"

echo "Removing installed application directory..."
rm -rf "$INSTALL_PATH"

echo "Removing old cloned repository..."
rm -rf "$CLONE_DIR"

echo ""
echo "Cloning fresh repository..."
git clone "$REPO_URL" "$CLONE_DIR"

echo ""
echo "================================="
echo " Reset complete."
echo " Now run install.sh again:"
echo " cd $CLONE_DIR/install"
echo " sudo ./install.sh"
echo "================================="
